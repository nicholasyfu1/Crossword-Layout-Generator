<html>
  <head>
    <title>Crossword Layout Generator</title>
    <meta charset="utf-8">
    <meta name="description" content="An open source crossword layout generator.">
    <meta name="author" content="Michael Wehar">
    <script src="layout_generator.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

    <script src="html2pdf.bundle.min.js"></script>

    <style>
      div.footer{
        width: 400px;
        font-size: 15px;
        color: #444444;
        max-height: 99999999px;
      }
    </style>
  </head>

  <body>

    <center>
      <br><br>
      <h1>Crossword Layout Generator</h1>
      <h2>Enter a list of words below</h2><br><br>

      <textarea id="words" rows="9" cols="35" autofocus="autofocus" style="font-size: 16px;" placeholder="Separate words and clues using ; and enter pairs on separate lines..."></textarea><br><br><br><br>

      <h3>Check if a word is in the crossword</h3>
      <input type="text" id="check-word" placeholder="Enter a word" style="font-size: 16px;">
      <button onclick="playCrossword();" style="font-size: 14px; cursor: pointer;">Check Word</button>
      <div id="word-check-result" style="font-size: 16px; margin-top: 10px;"></div>
      
      <button onclick="button_clicked();" style="font-size: 14px; cursor: pointer;">Generate Layout</button><br><br><br>

      <div id="content" style="font-family: 'Courier New', Courier, monospace"></div><br>

      <div id="blank-html-crossword" style="font-family: 'Courier New', Courier, monospace"></div><br>

      <div id="clues-html" style="font-family: 'Courier New', Courier, monospace"></div>

      <div id="filled-html-crossword" style="font-family: 'Courier New', Courier, monospace"></div><br>

      <div class="controls">
        <button onclick="downloadBlankPDF();">Download Blank Crossword PDF</button>
        <button onclick="downloadFilledPDF();">Download Filled Crossword PDF</button>
      </div>

      <h3><a href="https://github.com/MichaelWehar/Crossword-Layout-Generator">View Source Code (MIT License)</a><br><br><br>
      <a href="https://makeprojects.com/project/crossword-layout-generator---open-source">Short Article @ ProjectBoard</a></h3><br><br>

      <div class="footer">
        <br><hr><br>
        <center>
          Related pages: <a href="https://WordofTheHour.org">Word of The Hour</a>, <a href="http://michaelwehar.com/spellchecker/">Spell Checker</a>
          <br>
          <p style="padding: 7px;">Created by: Michael Wehar.</p>
          <br><br>
        </center>
      </div>
    </center>

    <script>
      function convert_to_json(word_list){
        var json_data = [];
        for(let i in word_list){
            if(word_list[i].trim().length > 0){
                var parts = word_list[i].split(";");
                var clue = parts[1] ? parts[1].trim() : '';
                json_data[i] = {"answer": parts[0].trim().toLowerCase(), "clue": clue};
            }
        }
        return json_data;
      }

      function create_word_search(alphabet, table){
        var tableArray = table.split("");
        for(let i = 0; i < tableArray.length; i++){
            if(tableArray[i] == '-'){
                var randomIndex = Math.floor(alphabet.length * Math.random());
                tableArray[i] = alphabet[randomIndex];
            }
        }
        return tableArray.join("");
      }
      
      /**
       * Generates HTML table from layout.table as a 2D array.
       */
      function generate_html_table(table, output_json) {
        var htmlText = '<table style="border-collapse: collapse; margin: 0 auto;">';
        for (let i = 0; i < table.length; i++) {
          htmlText += '<tr>';
          for (let j = 0; j < table[i].length; j++) {
            if (table[i][j] !== '-') { // If letter, add a white cell
              var wordPosition = output_json.find(word => word.startx === j + 1 && word.starty === i + 1); // Find word that starts here
              if (wordPosition) { // If word starts here, White cell with number
                htmlText += `<td style="width: 30px; height: 30px; border: 1px solid black; background-color: white; position: relative;">
                  <span style="position: absolute; top: 0; left: 0; font-size: 10px;">${wordPosition.position}</span></td>`;
              } else { // Blank white cell
                htmlText += '<td style="width: 30px; height: 30px; border: 1px solid black; background-color: white;"></td>';
              }
            } else { // If not letter, add a black cell
              htmlText += '<td style="width: 30px; height: 30px; border: 1px solid black; background-color: black;"></td>';
            }
          }
          htmlText += '</tr>';
        }
        htmlText += '</table>';
        return htmlText;
      }

      function generate_filled_crossword_table(table, output_json) {
        var htmlText = '<table style="border-collapse: collapse; margin: 0 auto;">';
        for (let i = 0; i < table.length; i++) {
          htmlText += '<tr>';
          for (let j = 0; j < table[i].length; j++) {
            if (table[i][j] !== '-') { // If letter, add a white cell and display the letter
              var wordPosition = output_json.find(word => word.startx === j + 1 && word.starty === i + 1); // Find word that starts here
              if (wordPosition) { // If word starts here, White cell with number and letter
                htmlText += `<td style="width: 30px; height: 30px; border: 1px solid black; background-color: white; text-align: center; vertical-align: middle; position: relative;">
                  <span style="font-size: 16px;">${table[i][j]}</span>
                  <span style="position: absolute; top: 0; left: 0; font-size: 10px;">${wordPosition.position}</span></td>`;
              } else { // White cell with letter
                htmlText += `<td style="width: 30px; height: 30px; border: 1px solid black; background-color: white; text-align: center; vertical-align: middle;">
                  <span style="font-size: 16px;">${table[i][j]}</span></td>`;
              }
            } else { // If not letter, add a black cell
              htmlText += '<td style="width: 30px; height: 30px; border: 1px solid black; background-color: black;"></td>';
            }
          }
          htmlText += '</tr>';
        }
        htmlText += '</table>';
        return htmlText;
      }

      function generate_clues(clues) {
        var htmlText = `<ul style="list-style-type: none; padding: 0;">`;
        clues.forEach((item, index) => {
          if (item.clue) {
            htmlText += `<li>${index + 1}. ${item.clue}</li>`;
          }
        });
        htmlText += `</ul>`;
        return htmlText;
      }

      function button_clicked(){
        // Input data
        var word_list = document.getElementById("words").value.split('\n');
        if(word_list[0] != ""){
          var input_json = convert_to_json(word_list);

          // Output data
          var layout = generateLayout(input_json);
          var rows = layout.rows;
          var cols = layout.cols;
          var table = layout.table; // table as two-dimensional array
          var output_html = layout.table_string; // table as plain text (with HTML line breaks)
          var output_json = layout.result; // words along with orientation, position, startx, and starty

          // Word search data
          var alphabet = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"];
          var word_search = create_word_search(alphabet, output_html);

          // Generate crossword HTML
          var crossword_html = generate_html_table(layout.table, output_json);

          var filled_crossword_html = generate_filled_crossword_table(layout.table, output_json);

          var clues_html = generate_clues(input_json);
          console.log(clues_html);

          // Display result
          document.getElementById("content").innerHTML = "<h3>Output JSON</h3><br>" + JSON.stringify(output_json) + "<br><br><h3>Output Html</h3><br>" + output_html + "<br><h3>Extra Output: Word Search</h3><br>" + word_search + "<br>";
          document.getElementById("blank-html-crossword").innerHTML = "<h3>Blank Crossword</h3><br>" + crossword_html;
          document.getElementById("filled-html-crossword").innerHTML = "<h3>Filled Crossword</h3>" + filled_crossword_html;
          document.getElementById("clues-html").innerHTML = "<h3>Clues</h3>" + clues_html;
        }
      }

      function playCrossword() {
        const wordGuess = document.getElementById("check-word").value.trim().toLowerCase();
        const wordsInGame = document.getElementById("words").value.split('\n');
        const crosswordData = convert_to_json(wordsInGame);

        let isWordInCrossword = false;
        for (let i=0; i<crosswordData.length; i++) {
          if (crosswordData[i].answer == wordGuess) {
            isWordInCrossword = true;
            break;
          }
        }

        const result = document.getElementById("word-check-result");
        if (isWordInCrossword) {
          result.textContent = `"${wordGuess}" is in the crossword.`;
          result.style.color = "green";
        }
        else {
          result.textContent = `"${wordGuess}" is NOT in the crossword.`;
          result.style.color = "red";
        }
      }

      function downloadBlankPDF() {
        // Create a temporary container to hold the combined content
        const tempContainer = document.createElement("div");
        tempContainer.id = "temp-pdf-container";
        tempContainer.style.fontFamily = "'Courier New', Courier, monospace";

        // Get the content of the blank crossword
        const blankCrossword = document.getElementById("blank-html-crossword").innerHTML;

        // Get the content of the clues
        const clues = document.getElementById("clues-html").innerHTML;

        // Combine both into the temporary container
        tempContainer.innerHTML = `
          ${blankCrossword}
          <br>
          ${clues}
        `;

        // Append the temporary container to the body (hidden)
        document.body.appendChild(tempContainer);

        // Define options for html2pdf
        const options = {
          margin: 1,
          filename: 'blank_crossword_with_clues.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        // Generate and download the PDF
        html2pdf()
          .set(options)
          .from(tempContainer)
          .save()
          .then(() => {
            // Clean up by removing the temporary container
            document.body.removeChild(tempContainer);
          });
      }

      function downloadFilledPDF() {
        const element = document.getElementById('filled-html-crossword'); // Target the filled crossword
        const options = {
          margin: 1,
          filename: 'Filled_Crossword.pdf',
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        html2pdf().set(options).from(element).save();
      }
    </script>

    <br><br>

  </body>
</html>
